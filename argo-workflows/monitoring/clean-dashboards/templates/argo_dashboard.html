<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clean Argo Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            padding: 2rem;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        .connection-test {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .connection-test h2 {
            margin-bottom: 1rem;
            color: #333;
        }

        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #0056b3;
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .connection-status {
            margin-top: 1rem;
            padding: 1rem;
            border-radius: 6px;
            display: none;
        }

        .status-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .status-error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .status-loading {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #6c757d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-success { color: #28a745; }
        .stat-danger { color: #dc3545; }
        .stat-warning { color: #ffc107; }
        .stat-info { color: #17a2b8; }

        .workflows-section {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .section-header {
            background: #f8f9fa;
            padding: 1.5rem;
            border-bottom: 1px solid #dee2e6;
        }

        .section-header h2 {
            margin: 0;
        }

        .workflows-table {
            width: 100%;
            border-collapse: collapse;
        }

        .workflows-table th,
        .workflows-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .workflows-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #495057;
        }

        .workflows-table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-succeeded {
            background: #d4edda;
            color: #155724;
        }

        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }

        .status-running {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-unknown {
            background: #e2e3e5;
            color: #383d41;
        }

        .status-deleted {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px dashed #bee5eb;
        }

        .deleted-row {
            opacity: 0.7;
            font-style: italic;
        }

        .refresh-btn {
            background: #28a745;
            margin-left: 1rem;
        }

        .refresh-btn:hover {
            background: #218838;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #6c757d;
        }

        .error-message {
            text-align: center;
            padding: 2rem;
            color: #dc3545;
            background: #f8d7da;
            border-radius: 6px;
            margin: 1rem 0;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üöÄ Clean Argo Dashboard</h1>
        <p>Minimal dashboard for Argo Workflows monitoring and connection testing</p>
    </div>

    <div class="container">
        <!-- Connection Test Section -->
        <div class="connection-test">
            <h2>üîó Connection Test</h2>
            <p>Test the connection to Argo Workflows to ensure everything is working properly.</p>
            <button id="testConnection" class="btn">Test Connection</button>
            <button id="refreshData" class="btn refresh-btn">Refresh Data</button>
            <div id="connectionStatus" class="connection-status"></div>
        </div>

        <!-- Statistics Section -->
        <div class="stats-grid" id="statsGrid">
            <!-- Stats will be loaded here -->
        </div>

        <!-- Workflows Section -->
        <div class="workflows-section">
            <div class="section-header">
                <h2>üìã Recent Workflows</h2>
            </div>
            <div id="workflowsContent">
                <div class="loading">Loading workflows...</div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let isLoading = false;

        // DOM elements
        const testConnectionBtn = document.getElementById('testConnection');
        const refreshDataBtn = document.getElementById('refreshData');
        const connectionStatus = document.getElementById('connectionStatus');
        const statsGrid = document.getElementById('statsGrid');
        const workflowsContent = document.getElementById('workflowsContent');

        // Event listeners
        testConnectionBtn.addEventListener('click', testConnection);
        refreshDataBtn.addEventListener('click', refreshAllData);

        // Test connection function
        async function testConnection() {
            if (isLoading) return;

            isLoading = true;
            testConnectionBtn.disabled = true;
            testConnectionBtn.textContent = 'Testing...';

            showConnectionStatus('loading', 'Testing connection to Argo Workflows...');

            try {
                const response = await fetch('/api/test-connection');
                const result = await response.json();

                if (result.status === 'success') {
                    showConnectionStatus('success', `‚úÖ ${result.message}\nNamespace: ${result.namespace}`);
                } else {
                    showConnectionStatus('error', `‚ùå ${result.message}`);
                }
            } catch (error) {
                showConnectionStatus('error', `‚ùå Connection failed: ${error.message}`);
            }

            isLoading = false;
            testConnectionBtn.disabled = false;
            testConnectionBtn.textContent = 'Test Connection';
        }

        // Show connection status
        function showConnectionStatus(type, message) {
            connectionStatus.className = `connection-status status-${type}`;
            connectionStatus.innerHTML = message.replace(/\n/g, '<br>');
            connectionStatus.style.display = 'block';
        }

        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();

                statsGrid.innerHTML = `
                    <div class="stat-card">
                        <div class="stat-number stat-info">${stats.total}</div>
                        <div class="stat-label">Total Workflows</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number stat-success">${stats.succeeded}</div>
                        <div class="stat-label">Succeeded</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number stat-danger">${stats.failed}</div>
                        <div class="stat-label">Failed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number stat-warning">${stats.running}</div>
                        <div class="stat-label">Running</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number stat-info">${stats.deleted}</div>
                        <div class="stat-label">Deleted</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number stat-info">${stats.avg_duration}s</div>
                        <div class="stat-label">Avg Duration</div>
                    </div>
                `;
            } catch (error) {
                statsGrid.innerHTML = '<div class="error-message">Failed to load statistics</div>';
            }
        }

        // Load workflows
        async function loadWorkflows() {
            try {
                const response = await fetch('/api/workflows?limit=15');
                const workflows = await response.json();

                if (workflows.length === 0) {
                    workflowsContent.innerHTML = '<div class="loading">No workflows found</div>';
                    return;
                }

                const tableHTML = `
                    <table class="workflows-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Status</th>
                                <th>Created</th>
                                <th>Started</th>
                                <th>Duration</th>
                                <th>Namespace</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${workflows.map(wf => `
                                <tr class="${wf.is_deleted ? 'deleted-row' : ''}">
                                    <td><strong>${wf.name}</strong></td>
                                    <td><span class="status-badge ${getStatusClass(wf.status)}">${wf.status}</span></td>
                                    <td>${formatTimestamp(wf.created_at)}</td>
                                    <td>${formatTimestamp(wf.started_at)}</td>
                                    <td>${formatDuration(wf.duration_seconds)}</td>
                                    <td>${wf.namespace}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;

                workflowsContent.innerHTML = tableHTML;
            } catch (error) {
                workflowsContent.innerHTML = '<div class="error-message">Failed to load workflows</div>';
            }
        }

        // Utility functions
        function formatTimestamp(timestamp) {
            if (!timestamp) return '-';
            return new Date(timestamp).toLocaleString();
        }

        function formatDuration(seconds) {
            if (!seconds) return '-';
            if (seconds < 60) return `${seconds.toFixed(1)}s`;
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}m ${remainingSeconds.toFixed(0)}s`;
        }

        function getStatusClass(status) {
            const statusLower = status.toLowerCase();
            if (statusLower.includes('deleted')) return 'status-deleted';
            if (statusLower.includes('succeeded')) return 'status-succeeded';
            if (statusLower.includes('failed')) return 'status-failed';
            if (statusLower.includes('running')) return 'status-running';
            return 'status-unknown';
        }

        // Refresh all data
        async function refreshAllData() {
            if (isLoading) return;

            isLoading = true;
            refreshDataBtn.disabled = true;
            refreshDataBtn.textContent = 'Refreshing...';

            await Promise.all([loadStats(), loadWorkflows()]);

            isLoading = false;
            refreshDataBtn.disabled = false;
            refreshDataBtn.textContent = 'Refresh Data';
        }

        // Initial load
        document.addEventListener('DOMContentLoaded', () => {
            refreshAllData();
        });

        // Auto-refresh every 30 seconds
        setInterval(refreshAllData, 30000);
    </script>
</body>
</html> 